---
title: "Assignment 2 - Regression models"
author: "Sergimayol"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r}
library(GGally)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(ggcorrplot)
```

## Data

```{r}
dataset <- read.csv("../datasets/cirrhosis.csv")
```

## Data preparation
```{r}
summary(dataset)
```

```{r}
str(dataset)
```

```{r}
df <- dataset
```

```{r}
df <- subset(df, select = -ID)
```

```{r}
df <- df %>% mutate(Drug = ifelse(is.na(Drug), "None", Drug))
```

```{r}
ggplot(df, aes(x = Drug)) +
  geom_bar(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Drugs taken", x = "Drug", y = "Count")
```
```{r}
ggplot(df, aes(x = Status)) +
  geom_bar(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Status", x = "Status", y = "Count")
```

```{r}
df$AgeInYear <- df$Age / 365.25 # 366
df$AgeInYear
```

```{r}
df$grupo_edad <- cut(df$AgeInYear,
  breaks = seq(0, 100, by = 10),
  include.lowest = TRUE,
  labels = FALSE
)
df$grupo_edad
```
```{r}
ggplot(df, aes(x = grupo_edad)) +
  geom_bar(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Number of people per decade", x = "Decade group", y = "Count")
```

```{r}
plot_corr <- ggcorr(
  data = df,
  low = "steelblue",
  mid = "white",
  high = "darkred",
  label = TRUE,
  label_alpha = 0,
  angle = -45,
  max_size = 10,
  min_size = 2,
  size = 3,
  hjust = 0.75
)
plot_corr +
  theme(text = element_text(size = 8))
```

```{r}
stage_proportions <- round(prop.table(table(df$Stage)), 2)
pie(stage_proportions, labels = paste(names(stage_proportions), ": ", stage_proportions), col = rainbow(length(stage_proportions)))
legend("topright", legend = names(stage_proportions), fill = rainbow(length(stage_proportions)), cex = 0.8, title = "Stage")
```

```{r}
stage_df <- subset(df, select = c(Stage, Ascites, Hepatomegaly, Spiders, Cholesterol, Alk_Phos, Bilirubin, Albumin, Copper, SGOT, Tryglicerides, Platelets, Prothrombin))

summary(stage_df)

stage_df <- stage_df %>% mutate(Ascites = ifelse(is.na(Ascites), "None", Ascites))
stage_df <- stage_df %>% mutate(Hepatomegaly = ifelse(is.na(Hepatomegaly), "None", Hepatomegaly))
stage_df <- stage_df %>% mutate(Spiders = ifelse(is.na(Spiders), "None", Spiders))
stage_df <- stage_df %>% mutate(Cholesterol = ifelse(is.na(Cholesterol), mean(Cholesterol, na.rm = TRUE), Cholesterol))
stage_df <- stage_df %>% mutate(Alk_Phos = ifelse(is.na(Alk_Phos), mean(Alk_Phos, na.rm = TRUE), Alk_Phos))
stage_df <- stage_df %>% mutate(SGOT = ifelse(is.na(SGOT), mean(SGOT, na.rm = TRUE), SGOT))
stage_df <- stage_df %>% mutate(Copper = ifelse(is.na(Copper), mean(Copper, na.rm = TRUE), Copper))
stage_df <- stage_df %>% mutate(Tryglicerides = ifelse(is.na(Tryglicerides), mean(Tryglicerides, na.rm = TRUE), Tryglicerides)) # nolint: line_length_linter.
stage_df <- stage_df %>% mutate(Platelets = ifelse(is.na(Platelets), mean(Platelets, na.rm = TRUE), Platelets)) # nolint: line_length_linter.
stage_df <- stage_df %>% mutate(Prothrombin = ifelse(is.na(Prothrombin), mean(Prothrombin, na.rm = TRUE), Prothrombin)) # nolint: line_length_linter. # nolint
stage_df <- stage_df %>% mutate(Stage = ifelse(is.na(Stage), median(Stage, na.rm = TRUE), Stage)) # nolint
```

```{r}
summary(stage_df)
str(stage_df)
```

```{r}
ggplot(stage_df, aes(x = Stage)) +
  geom_bar(fill = "skyblue", color = "black", alpha = 0.7)
```

```{r}
plot_corr <- ggcorr(
  data = stage_df,
  low = "steelblue",
  mid = "white",
  high = "darkred",
  label = TRUE,
  label_alpha = 0,
  angle = -45,
  max_size = 10,
  min_size = 2,
  size = 3,
  hjust = 0.75
)
plot_corr +
  theme(text = element_text(size = 8))
```

## Models

### Data split

```{r}
# TODO: Use df clean
stage_df$Status <- as.numeric(df$Status)

set.seed(123)
train_index <- sample(1:nrow(stage_df), 0.7 * nrow(stage_df))

train_data <- df[train_index, ]

test_data <- df[-train_index, ]

nrow(train_data)
nrow(test_data)
```

Modelos a emplear:

- Perceptron / lm <-
- Random dec. tree <-
- nearest neighbours <-
- SVM <-
- Logistic re

Objetivos:
- survival state of patients with liver cirrhosis

```{r}
library(mlpack)
```